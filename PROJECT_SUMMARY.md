# é¡¹ç›®æŠ€æœ¯æ€»ç»“

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: LangChain Agent with Multi-Memory Integration  
**å¼€å‘æ—¶é—´**: 2024å¹´12æœˆ  
**æŠ€æœ¯æ ˆ**: Python, LangChain, OpenRouter, Mem0, MCP  
**é¡¹ç›®çŠ¶æ€**: åŠŸèƒ½å®Œæ•´ï¼ŒæŒç»­ä¼˜åŒ–ä¸­  

## ğŸ¯ é¡¹ç›®ç›®æ ‡

æ„å»ºä¸€ä¸ªæ™ºèƒ½çš„ LangChain Agent ç³»ç»Ÿï¼Œé›†æˆå¤šç§è®°å¿†åç«¯ï¼Œå®ç°ï¼š
- æŒä¹…åŒ–çš„å¯¹è¯è®°å¿†èƒ½åŠ›
- æ™ºèƒ½çš„ä¿¡æ¯æ£€ç´¢å’Œå›å¿†
- çµæ´»çš„è®°å¿†ç³»ç»Ÿåˆ‡æ¢
- ç¨³å®šçš„é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶æ¶æ„

```
ç”¨æˆ·å±‚ (User Interface)
â”œâ”€â”€ main.py - ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ test_simple.py - åŸºç¡€åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_final.py - å®Œæ•´é›†æˆæµ‹è¯•
â””â”€â”€ demo.py - äº¤äº’å¼æ¼”ç¤º

ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic)
â”œâ”€â”€ chain_factory.py - Agent å·¥å‚å’ŒæœåŠ¡é€‰æ‹©é€»è¾‘
â”œâ”€â”€ llm_config.py - é…ç½®ç®¡ç†
â””â”€â”€ prompt_template.py - æç¤ºæ¨¡æ¿ç®¡ç†

è®°å¿†æœåŠ¡å±‚ (Memory Service Layer)
â”œâ”€â”€ mem0_tools.py - Mem0 AI é›†æˆ
â”œâ”€â”€ openmemory_tools.py - OpenMemory MCP é›†æˆ
â”œâ”€â”€ custom_tools.py - æ¨¡æ‹Ÿè®°å¿†å·¥å…·
â”œâ”€â”€ openmemory_client.py - OpenMemory å®¢æˆ·ç«¯
â””â”€â”€ memory_manager.py - åŸºç¡€è®°å¿†ç®¡ç†å™¨

åŸºç¡€è®¾æ–½å±‚ (Infrastructure)
â”œâ”€â”€ start_openmemory.py - æœåŠ¡å™¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ requirements.txt - ä¾èµ–ç®¡ç†
â””â”€â”€ .env - ç¯å¢ƒé…ç½®
```

### è®°å¿†ç³»ç»Ÿä¼˜å…ˆçº§

1. **Mem0 AI** (æœ€é«˜ä¼˜å…ˆçº§)
   - ä¸“ä¸šçš„ AI è®°å¿†ç®¡ç†ç³»ç»Ÿ
   - æ”¯æŒè‡ªåŠ¨äº‹å®æå–å’Œå‘é‡å­˜å‚¨
   - å½“å‰çŠ¶æ€: é…ç½®ä¸­ (embeddings å…¼å®¹æ€§é—®é¢˜)

2. **OpenMemory MCP** (ä¸­ç­‰ä¼˜å…ˆçº§)
   - åŸºäº Model Context Protocol çš„è®°å¿†æœåŠ¡
   - æ”¯æŒ REST API å’ŒæŒä¹…åŒ–å­˜å‚¨
   - å½“å‰çŠ¶æ€: éœ€è¦å¤–éƒ¨æœåŠ¡å™¨

3. **æ¨¡æ‹Ÿè®°å¿†å·¥å…·** (å›é€€é€‰é¡¹)
   - ç®€å•çš„å†…å­˜å­˜å‚¨ç³»ç»Ÿ
   - æ™ºèƒ½å…³é”®è¯åŒ¹é…æœç´¢
   - å½“å‰çŠ¶æ€: å®Œå…¨å¯ç”¨ âœ…

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. è‡ªåŠ¨æœåŠ¡é€‰æ‹©æœºåˆ¶

```python
def create_agent_executor():
    # æŒ‰ä¼˜å…ˆçº§æ£€æŸ¥å¹¶è·å–å·¥å…·
    if check_mem0_service():
        tools = get_mem0_tools()
        memory_service_used = "Mem0"
    elif check_openmemory_service():
        tools = get_openmemory_tools()
        memory_service_used = "OpenMemory"
    else:
        tools = get_mock_tools()
        memory_service_used = "Mock"
```

### 2. æ™ºèƒ½å…³é”®è¯æœç´¢

```python
def search_memory(self, query: str) -> list:
    keyword_mappings = {
        "åå­—": ["å§“å", "åå­—", "å«"],
        "é¢œè‰²": ["é¢œè‰²", "è‰²å½©"],
        "å–œæ¬¢": ["å–œæ¬¢", "åå¥½", "æœ€çˆ±"]
    }
    # æ‰©å±•æœç´¢å…³é”®è¯å¹¶åŒ¹é…è®°å¿†
```

### 3. é”™è¯¯å¤„ç†å’Œå¥åº·æ£€æŸ¥

```python
def health_check(self) -> bool:
    return self._memory is not None and self._is_healthy

def _run(self, text: str) -> str:
    try:
        client = get_mem0_client()
        if not client.health_check():
            return "é”™è¯¯: Mem0 æœåŠ¡ä¸å¯ç”¨"
        # æ‰§è¡Œæ“ä½œ
    except Exception as e:
        logging.error(f"æ“ä½œå¤±è´¥: {e}")
        return error_msg
```

## ğŸ“ˆ æ€§èƒ½åˆ†æ

### è®°å¿†ç³»ç»Ÿå¯¹æ¯”

| æŒ‡æ ‡ | Mem0 | OpenMemory MCP | æ¨¡æ‹Ÿå·¥å…· |
|------|------|----------------|----------|
| åˆå§‹åŒ–æ—¶é—´ | ~3s | ~5s | <0.1s |
| æœç´¢å‡†ç¡®æ€§ | é«˜ (å‘é‡æœç´¢) | é«˜ (æ•°æ®åº“æŸ¥è¯¢) | ä¸­ (å…³é”®è¯åŒ¹é…) |
| å†…å­˜æ¶ˆè€— | ä¸­ç­‰ (~200MB) | ä½ (~50MB) | å¾ˆä½ (~10MB) |
| æŒä¹…åŒ– | âœ… æœ¬åœ°æ–‡ä»¶ | âœ… æ•°æ®åº“ | âŒ å†…å­˜ |
| å¹¶å‘æ”¯æŒ | âœ… | âœ… | æœ‰é™ |
| æ‰©å±•æ€§ | é«˜ | é«˜ | ä½ |

### ç³»ç»Ÿæ€§èƒ½

- **å¯åŠ¨æ—¶é—´**: 2-5ç§’ (å–å†³äºè®°å¿†æœåŠ¡)
- **å“åº”æ—¶é—´**: 1-3ç§’ (åŒ…å« LLM è°ƒç”¨)
- **å†…å­˜å ç”¨**: 100-300MB (å–å†³äºè®°å¿†æœåŠ¡)
- **å¹¶å‘èƒ½åŠ›**: æ”¯æŒå¤šç”¨æˆ· (é€šè¿‡ user_id éš”ç¦»)

## âœ… å®Œæˆçš„åŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½
- âœ… å¤šè®°å¿†ç³»ç»Ÿé›†æˆ (Mem0, OpenMemory, Mock)
- âœ… è‡ªåŠ¨æœåŠ¡é€‰æ‹©å’Œå›é€€æœºåˆ¶
- âœ… ReAct Agent å¯¹è¯ç³»ç»Ÿ
- âœ… æ™ºèƒ½å…³é”®è¯æœç´¢
- âœ… ç¿»è¯‘åŠŸèƒ½é›†æˆ
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†

### å·¥å…·åŠŸèƒ½
- âœ… è®°å¿†æ·»åŠ  (add_memory)
- âœ… è®°å¿†æœç´¢ (search_memory)  
- âœ… è®°å¿†åˆ—è¡¨ (list_memories)
- âœ… è®°å¿†åˆ é™¤ (åˆ é™¤æ‰€æœ‰è®°å¿†)

### æµ‹è¯•è¦†ç›–
- âœ… å•å…ƒæµ‹è¯• (å„ä¸ªå·¥å…·)
- âœ… é›†æˆæµ‹è¯• (å®Œæ•´æµç¨‹)
- âœ… äº¤äº’å¼æ¼”ç¤º
- âœ… é”™è¯¯åœºæ™¯æµ‹è¯•

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. æ¨¡å—åŒ–è®¾è®¡
- é«˜åº¦è§£è€¦çš„æ¨¡å—ç»“æ„
- æ˜“äºæ‰©å±•æ–°çš„è®°å¿†åç«¯
- æ¸…æ™°çš„è´£ä»»åˆ†ç¦»

### 2. æ™ºèƒ½å›é€€æœºåˆ¶
- è‡ªåŠ¨æ£€æµ‹æœåŠ¡å¯ç”¨æ€§
- ä¼˜é›…çš„æœåŠ¡é™çº§
- é›¶åœæœºæ—¶é—´åˆ‡æ¢

### 3. ç»Ÿä¸€çš„å·¥å…·æ¥å£
- æ‰€æœ‰è®°å¿†æœåŠ¡ä½¿ç”¨ç›¸åŒçš„å·¥å…·æ¥å£
- LangChain BaseTool æ ‡å‡†å®ç°
- ç±»å‹å®‰å…¨çš„å‚æ•°éªŒè¯

### 4. çµæ´»çš„é…ç½®ç®¡ç†
- ç¯å¢ƒå˜é‡é©±åŠ¨çš„é…ç½®
- å¤šç¯å¢ƒæ”¯æŒ
- æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

## ğŸ› å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### æŠ€æœ¯é—®é¢˜
1. **Mem0 Embeddings å…¼å®¹æ€§**
   - OpenRouter ä¸æ”¯æŒ embeddings ç«¯ç‚¹
   - éœ€è¦é¢å¤–çš„ embeddings æœåŠ¡

2. **OpenMemory æœåŠ¡ä¾èµ–**
   - éœ€è¦æ‰‹åŠ¨å¯åŠ¨å¤–éƒ¨æœåŠ¡
   - Docker ç¯å¢ƒé…ç½®å¤æ‚

3. **æ¨¡æ‹Ÿå·¥å…·é™åˆ¶**
   - ä»…æ”¯æŒå†…å­˜å­˜å‚¨
   - æœç´¢ç²¾åº¦æœ‰é™

### æ€§èƒ½é™åˆ¶
- LLM è°ƒç”¨å»¶è¿Ÿ (1-3ç§’)
- è®°å¿†æœç´¢ä¸æ”¯æŒæ¨¡ç³ŠåŒ¹é… (Mem0é™¤å¤–)
- å•å®ä¾‹å†…å­˜å…±äº«é—®é¢˜

## ğŸš€ æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ– (v1.1)
- [ ] ä¿®å¤ Mem0 embeddings é…ç½®
- [ ] æ·»åŠ æ›´å¤š LLM æä¾›å•†æ”¯æŒ
- [ ] å®ç°è®°å¿†å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
- [ ] ä¼˜åŒ–æœç´¢ç®—æ³•

### ä¸­æœŸè§„åˆ’ (v1.5)
- [ ] Web UI ç•Œé¢å¼€å‘
- [ ] å¤šç”¨æˆ·éš”ç¦»å’Œæƒé™ç®¡ç†
- [ ] è®°å¿†åˆ†ç±»å’Œæ ‡ç­¾ç³»ç»Ÿ
- [ ] æ€§èƒ½ç›‘æ§å’Œåˆ†æ

### é•¿æœŸè§„åˆ’ (v2.0)
- [ ] åˆ†å¸ƒå¼è®°å¿†æ¶æ„
- [ ] å®æ—¶è®°å¿†åŒæ­¥
- [ ] é«˜çº§ AI è®°å¿†åˆ†æ
- [ ] ä¼ä¸šçº§éƒ¨ç½²æ”¯æŒ

## ğŸ“š å­¦ä¹ ä»·å€¼

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†ä»¥ä¸‹æŠ€æœ¯æ¦‚å¿µï¼š

1. **LangChain Framework**
   - Agent å’Œ Tool çš„ä½¿ç”¨
   - Chain çš„æ„å»ºå’Œç»„åˆ
   - æç¤ºå·¥ç¨‹å’Œæ¨¡æ¿ç®¡ç†

2. **è®¾è®¡æ¨¡å¼**
   - å·¥å‚æ¨¡å¼ (Agent Factory)
   - å•ä¾‹æ¨¡å¼ (Memory Manager)
   - ç­–ç•¥æ¨¡å¼ (Memory Service Selection)

3. **ç³»ç»Ÿæ¶æ„**
   - åˆ†å±‚æ¶æ„è®¾è®¡
   - æœåŠ¡å‘ç°å’Œå›é€€
   - é”™è¯¯å¤„ç†å’Œæ¢å¤

4. **API é›†æˆ**
   - REST API å®¢æˆ·ç«¯å®ç°
   - å¼‚æ­¥æ“ä½œå¤„ç†
   - é…ç½®ç®¡ç†æœ€ä½³å®è·µ

## ğŸ¯ æ€»ç»“

è¿™ä¸ªé¡¹ç›®æˆåŠŸå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å¤šè®°å¿†é›†æˆ LangChain Agent ç³»ç»Ÿã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œæ™ºèƒ½å›é€€æœºåˆ¶ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯æ‰©å±•æ€§ã€‚è™½ç„¶åœ¨æŸäº›é«˜çº§åŠŸèƒ½ä¸Šè¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œä½†å·²ç»å…·å¤‡äº†ç”Ÿäº§ä½¿ç”¨çš„åŸºæœ¬æ¡ä»¶ã€‚

é¡¹ç›®æœ€å¤§çš„æˆåŠŸåœ¨äºï¼š
- **ç¨³å®šæ€§**: å³ä½¿é«˜çº§æœåŠ¡ä¸å¯ç”¨ï¼Œç³»ç»Ÿä»èƒ½æ­£å¸¸å·¥ä½œ
- **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„è®°å¿†åç«¯å’ŒåŠŸèƒ½
- **ç”¨æˆ·ä½“éªŒ**: æä¾›äº†å®Œæ•´çš„æµ‹è¯•å’Œæ¼”ç¤ºåŠŸèƒ½

è¿™ä¸ºåç»­çš„AI Agentå¼€å‘æä¾›äº†ä¸€ä¸ªå¯é çš„åŸºç¡€æ¶æ„ã€‚ 